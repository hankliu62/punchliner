# GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½² Next.js åˆ° Vercel å®Œå…¨æŒ‡å—

> æ·±åº¦è§£æã€ŒDeploy from a branchã€æ¨¡å¼ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ æ­å»ºä¼ä¸šçº§ CI/CD æµæ°´çº¿

![GitHub Actions + Vercel éƒ¨ç½²æ¶æ„](https://picsum.photos/seed/vercel-gh/1200/600)

## å‰è¨€

åœ¨å‰ç«¯å·¥ç¨‹åŒ–æ—¥ç›Šæˆç†Ÿçš„ä»Šå¤©ï¼Œè‡ªåŠ¨åŒ–éƒ¨ç½²å·²ç»æˆä¸ºæå‡å¼€å‘æ•ˆç‡çš„æ ‡å‡†é…ç½®ã€‚å¯¹äº Next.js å¼€å‘è€…æ¥è¯´ï¼ŒVercel æä¾›äº†å¼€ç®±å³ç”¨çš„éƒ¨ç½²ä½“éªŒï¼Œä½†æ ‡å‡†çš„ã€Œä¸€é”®éƒ¨ç½²ã€æ¨¡å¼å¾€å¾€æ— æ³•æ»¡è¶³ä¼ä¸šå¯¹æ„å»ºæµç¨‹çš„ç²¾ç»†æ§åˆ¶éœ€æ±‚ã€‚

æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡ **GitHub Actions + Vercel** çš„ç»„åˆæ¨¡å¼ï¼Œå®ç°å®Œå…¨å¯æ§çš„è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ã€‚æˆ‘ä»¬ä¼šæ·±å…¥æ¢è®¨æ¯ä¸€æ­¥é…ç½®çš„åŸç†ï¼Œè§£æå¤šå±‚ç¼“å­˜ä¼˜åŒ–ç­–ç•¥ï¼Œå¹¶æä¾›å¯ç›´æ¥å¤ç”¨çš„é…ç½®æ¨¡æ¿ã€‚

**ç‰¹åˆ«è¯´æ˜**ï¼šæœ¬æ–‡é‡‡ç”¨ã€ŒDeploy from a branchã€æ¨¡å¼ï¼Œå³ä»£ç çš„æ„å»ºè¿‡ç¨‹å®Œå…¨åœ¨ GitHub Actions runner ä¸­å®Œæˆï¼Œä»…å°†æ„å»ºäº§ç‰©æ¨é€åˆ° Vercelã€‚è¿™ç§æ–¹å¼ä¸ Vercel åŸç”Ÿè‡ªåŠ¨éƒ¨ç½²ç›¸æ¯”ï¼Œèµ‹äºˆäº†å¼€å‘è€…å¯¹æ„å»ºç¯å¢ƒçš„å®Œå…¨æ§åˆ¶æƒã€‚

---

## ä¸€ã€éƒ¨ç½²æ¶æ„æ€»è§ˆ

### 1.1 æ•´ä½“æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           GitHub Actions + Vercel éƒ¨ç½²æ¶æ„                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    push     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  å¼€å‘è€…   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚    GitHub ä»“åº“      â”‚         â”‚     Vercel      â”‚
    â”‚  æœ¬åœ°å¼€å‘  â”‚            â”‚   (master åˆ†æ”¯)     â”‚         â”‚   (ç”Ÿäº§ç¯å¢ƒ)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚                                 â”‚
                                       â”‚  è§¦å‘ Workflow                  â”‚
                                       â–¼                                 â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
                            â”‚  GitHub Actions    â”‚                        â”‚
                            â”‚  (Ubuntu Runner)   â”‚                        â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                                       â”‚                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
                    â”‚                  â”‚                  â”‚                â”‚
                    â–¼                  â–¼                  â–¼                â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
           â”‚   Checkout   â”‚   â”‚   Setup      â”‚   â”‚  Install     â”‚        â”‚
           â”‚    ä»£ç       â”‚â”€â”€â–ºâ”‚   Node.js    â”‚â”€â”€â–ºâ”‚   pnpm      â”‚        â”‚
           â”‚              â”‚   â”‚   + pnpm     â”‚   â”‚   deps      â”‚        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                                                       â”‚                  â”‚
                                                       â–¼                  â”‚
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
                                              â”‚   Next.js    â”‚          â”‚
                                              â”‚   Build      â”‚          â”‚
                                              â”‚  (.next/)    â”‚          â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                                     â”‚                  â”‚
                                                     â–¼                  â”‚
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ¨é€æ„å»ºäº§ç‰©
                                              â”‚   Deploy     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
                                              â”‚   to Vercel â”‚    (vercel-action)
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | è¯´æ˜ |
|---------|------|------|
| Next.js | 16.1.6 | React å…¨æ ˆæ¡†æ¶ |
| pnpm | 9 | é«˜æ€§èƒ½åŒ…ç®¡ç†å™¨ |
| Node.js | 20 | è¿è¡Œæ—¶ç¯å¢ƒ |
| GitHub Actions | - | CI/CD è‡ªåŠ¨åŒ– |
| Vercel | - | æ‰˜ç®¡å¹³å° |

---

## äºŒã€å‡†å¤‡å·¥ä½œï¼šVercel å‡­è¯é…ç½®

åœ¨å¼€å§‹é…ç½® GitHub Actions ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆ Vercel çš„ API å‡­è¯é…ç½®ã€‚è¿™æ˜¯æ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹çš„åŸºç¡€ã€‚

### 2.1 è·å– Vercel Token

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® Vercel ä»¤ç‰Œç®¡ç†é¡µé¢ï¼šhttps://vercel.com/account/settings/tokens

![Vercel Tokens é¡µé¢](https://picsum.photos/seed/vercel-tokens/900/400)

ç‚¹å‡» **Create** æŒ‰é’®åˆ›å»ºä¸€ä¸ªæ–°ä»¤ç‰Œï¼š

![åˆ›å»º Vercel Token](https://picsum.photos/seed/vercel-create-token/700/350)

åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œç»™ä»¤ç‰Œå–ä¸€ä¸ªå®¹æ˜“è¯†åˆ«çš„åç§°ï¼Œä¾‹å¦‚ã€ŒGitHub Actions Deployã€ï¼Œç„¶åç‚¹å‡» **Create**ï¼š

> âš ï¸ **é‡è¦æç¤º**ï¼šä»¤ç‰Œåˆ›å»ºæˆåŠŸåï¼Œè¯·ç«‹å³å¤åˆ¶å¹¶ä¿å­˜åˆ°å®‰å…¨çš„åœ°æ–¹ã€‚Vercel å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œåªä¼šæ˜¾ç¤ºè¿™ä¸€æ¬¡ï¼
>
> **æ³¨æ„**ï¼šåˆ›å»ºçš„ Token æ ¼å¼ä¸º `vcp_` å¼€å¤´ï¼ˆå¦‚ `vcp_xxxxxxxxxxxxxx`ï¼‰ï¼Œä¸è¦ä¸ `vercel link` ç”Ÿæˆçš„ `VERCEL_OIDC_TOKEN` æ··æ·†ã€‚

### 2.2 è·å–é¡¹ç›®é…ç½® ID

è·å– VERCEL_ORG_ID å’Œ VERCEL_PROJECT_ID æœ‰ä¸¤ç§æ–¹æ³•ï¼š

#### æ–¹æ³•ä¸€ï¼šä» Vercel Dashboard è·å–

å›åˆ° Vercel è®¾ç½®é¡µé¢ï¼Œè¿™æ¬¡é€‰æ‹© **General** é€‰é¡¹å¡ï¼š

![Vercel General è®¾ç½®](https://picsum.photos/seed/vercel-general/900/500)

**å¯¹äºä¸ªäººè´¦æˆ·**ï¼š
- **ORG_ID = User ID**ï¼šç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ Account Settings â†’ Generalï¼Œåº•éƒ¨æ‰¾åˆ° **User ID**ï¼ˆæ ¼å¼ï¼š`usr_xxxxxxxx`ï¼‰
- **PROJECT_ID**ï¼šé€‰æ‹©ä½ çš„é¡¹ç›® â†’ Settings â†’ å‘ä¸‹æ»šåŠ¨æ‰¾åˆ° **Project ID**ï¼ˆæ ¼å¼ï¼š`prj_xxxxxxxx`ï¼‰

**å¯¹äºå›¢é˜Ÿè´¦æˆ·**ï¼š
- **ORG_ID**ï¼šAccount Settings â†’ General â†’ Team IDï¼ˆæ ¼å¼ï¼š`team_xxxxxxxx`ï¼‰
- **PROJECT_ID**ï¼šé¡¹ç›® Settings â†’ Project ID

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|--------|
| VERCEL_ORG_ID | ä¸ªäººè´¦æˆ·ä¸º User IDï¼Œå›¢é˜Ÿè´¦æˆ·ä¸º Team ID | usr_xxxxxxxx / team_xxxxxxxx |
| VERCEL_PROJECT_ID | é¡¹ç›®å”¯ä¸€æ ‡è¯† | prj_xxxxxxxxxxxxxx |

#### æ–¹æ³•äºŒï¼šç”¨ Vercel CLI è·å–ï¼ˆæ¨èï¼‰

åœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. å…¨å±€å®‰è£… Vercel CLIï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
npm i -g vercel

# 2. ç™»å½• Vercel
vercel login

# 3. è¿›å…¥é¡¹ç›®ç›®å½•å¹¶é“¾æ¥
cd your-project
vercel link

# 4. æŸ¥çœ‹é¡¹ç›®ä¿¡æ¯
cat .vercel/project.json
```

è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š

```json
{
  "projectId": "prj_xxxxxxxxxxxxxx",
  "orgId": "usr_xxxxxxxxxxxxxx"
}
```

å…¶ä¸­ï¼š
- `projectId` å°±æ˜¯ **VERCEL_PROJECT_ID**
- `orgId` å°±æ˜¯ **VERCEL_ORG_ID**ï¼ˆä¸ªäººè´¦æˆ·ä¸º `usr_` å¼€å¤´ï¼‰

å°†è¿™ä¸¤ä¸ª ID è®°å½•ä¸‹æ¥å¤‡ç”¨ã€‚

### 2.3 é…ç½® GitHub Secrets

ç°åœ¨æˆ‘ä»¬éœ€è¦å°† Vercel çš„å‡­è¯å®‰å…¨åœ°å­˜å‚¨åˆ° GitHub ä»“åº“ä¸­ã€‚

æ‰“å¼€ä½ çš„ GitHub ä»“åº“é¡µé¢ï¼Œç‚¹å‡» **Settings** é€‰é¡¹å¡ï¼š

![GitHub ä»“åº“è®¾ç½®](https://picsum.photos/seed/gh-settings/900/400)

åœ¨å·¦ä¾§èœå•ä¸­æ‰¾åˆ° **Secrets and variables** ä¸‹çš„ **Actions** é€‰é¡¹ï¼š

![GitHub Actions Secrets](https://picsum.photos/seed/gh-secrets/900/450)

ç‚¹å‡» **New repository secret** æŒ‰é’®ï¼Œæ·»åŠ ä»¥ä¸‹å¯†é’¥ï¼š

#### Vercel éƒ¨ç½²æ‰€éœ€ Secrets

| Name | Secret æ¥æº | ç¤ºä¾‹å€¼ |
|------|-----------|--------|
| `VERCEL_TOKEN` | Vercel Tokens é¡µé¢åˆ›å»º (vcp_ å¼€å¤´) | `vcp_xxxxxxxxxxxxxx` |
| `VERCEL_ORG_ID` | User ID (ä¸ªäººè´¦æˆ·) æˆ– Team ID (å›¢é˜Ÿ) | `usr_xxxxxxxx` / `team_xxxxxxxx` |
| `VERCEL_PROJECT_ID` | é¡¹ç›® Settings é‡Œçš„ Project ID | `prj_xxxxxxxx` |

#### åº”ç”¨ç¯å¢ƒå˜é‡ Secrets

| Name | Secret æ¥æº | è¯´æ˜ |
|------|-----------|------|
| `ZHIPU_API_KEY` | æ™ºè°± AI å¼€æ”¾å¹³å° | AI ç”Ÿæˆå†…å®¹æ‰€éœ€ |
| `MXNZP_APP_ID` | MXNZP å¼€æ”¾å¹³å° | è·å–æ®µå­æ•°æ®æ‰€éœ€ |
| `MXNZP_APP_SECRET` | MXNZP å¼€æ”¾å¹³å° | è·å–æ®µå­æ•°æ®æ‰€éœ€ |

å®Œæˆåçš„ Secrets åˆ—è¡¨åº”è¯¥ç±»ä¼¼è¿™æ ·ï¼š

![Secrets åˆ—è¡¨](https://picsum.photos/seed/gh-secrets-list/900/300)

> âš ï¸ **é‡è¦è¯´æ˜**ï¼šæ„å»ºæ—¶é€šè¿‡ `env:` é…ç½®çš„ç¯å¢ƒå˜é‡åªåœ¨ GitHub Actions æ„å»ºè¿‡ç¨‹ä¸­ç”Ÿæ•ˆï¼Œä¸ä¼šè‡ªåŠ¨åŒæ­¥åˆ° Vercelã€‚Workflow ä¸­ä½¿ç”¨ `vercel env add` å‘½ä»¤åœ¨éƒ¨ç½²æ—¶è‡ªåŠ¨åŒæ­¥è¿™äº›å˜é‡åˆ° Vercelã€‚

---

## ä¸‰ã€é¡¹ç›®é…ç½®ï¼šç¯å¢ƒå‡†å¤‡

åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿é¡¹ç›®é…ç½®æ­£ç¡®ï¼Œä»¥ä¾¿ GitHub Actions èƒ½å¤Ÿé¡ºåˆ©æ‰§è¡Œæ„å»ºã€‚

### 3.1 åˆ‡æ¢åˆ° pnpmï¼ˆæ¨èï¼‰

ç›¸æ¯” npm å’Œ yarnï¼Œpnpm å…·æœ‰ä»¥ä¸‹æ˜¾è‘—ä¼˜åŠ¿ï¼š

| ç‰¹æ€§ | npm | yarn | pnpm |
|------|-----|------|------|
| ç£ç›˜å ç”¨ | è¾ƒå¤§ | è¾ƒå¤§ | æœ€å°ï¼ˆç¡¬é“¾æ¥ï¼‰ |
| å®‰è£…é€Ÿåº¦ | è¾ƒæ…¢ | ä¸­ç­‰ | æœ€å¿« |
| ä¾èµ–ç®¡ç† | æ‰å¹³åŒ– | æ‰å¹³åŒ– | éæ‰å¹³åŒ–ï¼ˆæ›´å®‰å…¨ï¼‰ |
| lockfile | package-lock.json | yarn.lock | pnpm-lock.yaml |

å¦‚æœä½ ä¹‹å‰ä½¿ç”¨çš„æ˜¯ npmï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤åˆ‡æ¢åˆ° pnpmï¼š

```bash
# 1. å…¨å±€å®‰è£… pnpm
npm install -g pnpm

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd your-project

# 3. åˆ é™¤æ—§çš„ node_modules å’Œ package-lock.json
rm -rf node_modules package-lock.json

# 4. ä½¿ç”¨ pnpm é‡æ–°å®‰è£…ä¾èµ–
pnpm install
```

### 3.2 é¡¹ç›® package.json é…ç½®

ä»¥ä¸‹æ˜¯ Punchliner é¡¹ç›®çš„å®Œæ•´ package.json é…ç½®ï¼Œä¾›ä½ å‚è€ƒï¼š

```json
{
  "name": "punchliner",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "biome lint src/",
    "lint:fix": "biome lint --write src/",
    "format": "biome format --write src/",
    "prepare": "husky"
  },
  "dependencies": {
    "@ant-design/icons": "^6.1.0",
    "antd": "^6.3.0",
    "clsx": "^2.1.1",
    "dayjs": "^1.11.19",
    "framer-motion": "^12.34.0",
    "next": "^16.1.6",
    "react": "^19.2.4",
    "react-dom": "^19.2.4",
    "react-hot-toast": "^2.6.0"
  },
  "devDependencies": {
    "@biomejs/biome": "^2.4.0",
    "@commitlint/cli": "^20.4.2",
    "@commitlint/config-conventional": "^20.4.2",
    "@tailwindcss/typography": "^0.5.16",
    "@types/node": "^25.2.3",
    "@types/react": "^19.2.14",
    "@types/react-dom": "^19.2.3",
    "autoprefixer": "^10.4.24",
    "husky": "^9.1.7",
    "lint-staged": "^16.2.7",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.19",
    "typescript": "^5.9.3"
  }
}
```

### 3.3 Next.js é…ç½®

ä¸ºäº†è®© GitHub Actions æ„å»ºçš„äº§ç‰©èƒ½å¤Ÿæ­£ç¡®éƒ¨ç½²åˆ° Vercelï¼Œæˆ‘ä»¬éœ€è¦å¯¹ next.config.mjs è¿›è¡Œé…ç½®ï¼š

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**',
      },
    ],
  },
}

// æ˜¯å¦é€šè¿‡github actionséƒ¨ç½²
const isGithubActions = process.env.GITHUB_ACTIONS || false

if (isGithubActions) {
  const repo = process.env.GITHUB_REPOSITORY 
    ? process.env.GITHUB_REPOSITORY.replace(/.*?\//, '') 
    : ''
  
  // ç”¨äºä¸ºé™æ€èµ„æºè®¾ç½® URL å‰ç¼€
  nextConfig.assetPrefix = `/${repo}/`
  
  // ç”¨äºä¸ºåº”ç”¨è®¾ç½®åŸºç¡€è·¯å¾„
  nextConfig.basePath = `/${repo}`
  
  // åˆå§‹åŒ– env å¯¹è±¡
  nextConfig.env = nextConfig.env || {}
  nextConfig.env.ROUTE_PREFIX = `/${repo}`
}

export default nextConfig
```

è¿™æ®µé…ç½®çš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š

1. **æ£€æµ‹éƒ¨ç½²ç¯å¢ƒ**ï¼šé€šè¿‡ `GITHUB_ACTIONS` ç¯å¢ƒå˜é‡åˆ¤æ–­æ˜¯å¦åœ¨ GitHub Actions ä¸­è¿è¡Œ
2. **æå–ä»“åº“å**ï¼šä» `GITHUB_REPOSITORY` ä¸­æå–ä»“åº“åç§°ï¼ˆå¦‚ `username/project-name`ï¼‰
3. **é…ç½®è·¯å¾„å‰ç¼€**ï¼šè®¾ç½® `assetPrefix` å’Œ `basePath`ï¼Œç¡®ä¿é™æ€èµ„æºå’Œè·¯ç”±æ­£ç¡®åŠ è½½

---

## å››ã€GitHub Actions å·¥ä½œæµé…ç½®

ç°åœ¨åˆ°äº†æ ¸å¿ƒç¯èŠ‚â€”â€”åˆ›å»º GitHub Actions å·¥ä½œæµæ–‡ä»¶ã€‚

### 4.1 åˆ›å»ºå·¥ä½œæµæ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `.github/workflows` ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼Œç„¶ååœ¨å…¶ä¸­åˆ›å»º `vercel.yml` æ–‡ä»¶ï¼š

```yaml
name: Vercel ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

on:
  push:
    branches: [master]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: è·å–æºç 
        uses: actions/checkout@v4

      - name: å®‰è£… pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9
          run_install: false

      - name: Node ç¯å¢ƒç‰ˆæœ¬
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: pnpm ç¼“å­˜è·¯å¾„
        shell: bash
        run: |
          echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV

      - name: ç¼“å­˜ pnpm ä¾èµ–
        uses: actions/cache@v4
        with:
          path: ${{ env.STORE_PATH }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-store-

      - name: å®‰è£…ä¾èµ–
        run: pnpm install --frozen-lockfile

      - name: ç¼“å­˜ Next.js æ„å»º
        uses: actions/cache@v4
        with:
          path: .next/cache
          key: ${{ runner.os }}-nextjs-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-nextjs-

      - name: æ‰“åŒ…
        run: pnpm run build
        env:
          ZHIPU_API_KEY: ${{ secrets.ZHIPU_API_KEY }}
          MXNZP_APP_ID: ${{ secrets.MXNZP_APP_ID }}
          MXNZP_APP_SECRET: ${{ secrets.MXNZP_APP_SECRET }}

      - name: é“¾æ¥ Vercel é¡¹ç›®
        run: |
          npx vercel@latest link --token=${{ secrets.VERCEL_TOKEN }} --yes

      - name: æ·»åŠ ç¯å¢ƒå˜é‡åˆ° Vercel
        run: |
          # æ·»åŠ  ZHIPU_API_KEY
          echo "${{ secrets.ZHIPU_API_KEY }}" | npx vercel@latest env add ZHIPU_API_KEY production --token=${{ secrets.VERCEL_TOKEN }}
          
          # æ·»åŠ  MXNZP_APP_ID
          echo "${{ secrets.MXNZP_APP_ID }}" | npx vercel@latest env add MXNZP_APP_ID production --token=${{ secrets.VERCEL_TOKEN }}
          
          # æ·»åŠ  MXNZP_APP_SECRET
          echo "${{ secrets.MXNZP_APP_SECRET }}" | npx vercel@latest env add MXNZP_APP_SECRET production --token=${{ secrets.VERCEL_TOKEN }}

      - name: éƒ¨ç½²åˆ° Vercel
        run: |
          npx vercel@latest --prod --token=${{ secrets.VERCEL_TOKEN }}
```

### 4.2 é…ç½®è¯¦è§£

è®©æˆ‘é€ä¸€è§£æè¿™ä¸ªå·¥ä½œæµé…ç½®çš„æ¯ä¸ªéƒ¨åˆ†ï¼š

#### è§¦å‘æ¡ä»¶ä¸å¹¶å‘æ§åˆ¶

```yaml
on:
  push:
    branches: [master]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
```

- **on.push.branches**: è®¾ç½®ä¸º `master`ï¼Œæ„å‘³ç€åªæœ‰å½“ä»£ç æ¨é€åˆ° master åˆ†æ”¯æ—¶æ‰è§¦å‘éƒ¨ç½²
- **concurrency**: é˜²æ­¢é‡å¤éƒ¨ç½²ï¼Œå½“æ–°æ¨é€åˆ°æ¥æ—¶è‡ªåŠ¨å–æ¶ˆä¹‹å‰çš„éƒ¨ç½²ä»»åŠ¡

#### ç¯å¢ƒé…ç½®

```yaml
- name: Setup pnpm
  uses: pnpm/action-setup@v4
  with:
    version: 9

- name: Setup Node.js
  uses: actions/setup-node@v4
  with:
    node-version: '20'
    cache: 'pnpm'
```

è¿™é‡Œä½¿ç”¨äº† **åŒå±‚ç¼“å­˜æœºåˆ¶**ï¼š

1. **ç¬¬ä¸€å±‚**ï¼š`actions/setup-node` è‡ªå¸¦çš„ pnpm ç¼“å­˜ï¼Œè‡ªåŠ¨è¯†åˆ« pnpm-lock.yaml
2. **ç¬¬äºŒå±‚**ï¼šæ‰‹åŠ¨é…ç½®çš„ pnpm store ç¼“å­˜ï¼Œæä¾›æ›´é«˜çš„å‘½ä¸­ç‡

#### æ„å»ºç¼“å­˜

```yaml
- name: Next.js build cache
  uses: actions/cache@v4
  with:
    path: .next/cache
    key: ${{ runner.os }}-nextjs-${{ hashFiles('**/pnpm-lock.yaml') }}
    restore-keys: |
      ${{ runner.os }}-nextjs-
```

Next.js æ„å»ºç¼“å­˜å¯ä»¥æ˜¾è‘—ç¼©çŸ­æ„å»ºæ—¶é—´ï¼š

| åœºæ™¯ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ |
|------|--------|--------|
| é¦–æ¬¡æ„å»º | ~3åˆ†é’Ÿ | ~3åˆ†é’Ÿ |
| äºŒæ¬¡æ„å»ºï¼ˆä»£ç æ— å˜åŒ–ï¼‰ | ~3åˆ†é’Ÿ | ~30ç§’ |
| äºŒæ¬¡æ„å»ºï¼ˆä¾èµ–å˜åŒ–ï¼‰ | ~3åˆ†é’Ÿ | ~2åˆ†é’Ÿ |

#### ç¯å¢ƒå˜é‡ä¼ é€’

```yaml
- name: æ‰“åŒ…
  run: pnpm run build
  env:
    ZHIPU_API_KEY: ${{ secrets.ZHIPU_API_KEY }}
    MXNZP_APP_ID: ${{ secrets.MXNZP_APP_ID }}
    MXNZP_APP_SECRET: ${{ secrets.MXNZP_APP_SECRET }}
```

é€šè¿‡ `secrets` ä¼ é€’æ•æ„Ÿç¯å¢ƒå˜é‡ï¼Œè¿™äº›å˜é‡ä¼šåœ¨ GitHub Actions runner ä¸­å¯ç”¨ã€‚

#### Vercel ç¯å¢ƒå˜é‡åŒæ­¥

```yaml
- name: é“¾æ¥ Vercel é¡¹ç›®
  run: |
    npx vercel@latest link --token=${{ secrets.VERCEL_TOKEN }} --yes

- name: æ·»åŠ ç¯å¢ƒå˜é‡åˆ° Vercel
  run: |
    # æ·»åŠ  ZHIPU_API_KEY
    echo "${{ secrets.ZHIPU_API_KEY }}" | npx vercel@latest env add ZHIPU_API_KEY production --token=${{ secrets.VERCEL_TOKEN }}
    
    # æ·»åŠ  MXNZP_APP_ID
    echo "${{ secrets.MXNZP_APP_ID }}" | npx vercel@latest env add MXNZP_APP_ID production --token=${{ secrets.VERCEL_TOKEN }}
    
    # æ·»åŠ  MXNZP_APP_SECRET
    echo "${{ secrets.MXNZP_APP_SECRET }}" | npx vercel@latest env add MXNZP_APP_SECRET production --token=${{ secrets.VERCEL_TOKEN }}
```

è¿™ä¸€æ­¥éå¸¸é‡è¦ï¼å®ƒä¼šåœ¨æ¯æ¬¡éƒ¨ç½²æ—¶è‡ªåŠ¨å°† GitHub Secrets ä¸­çš„ç¯å¢ƒå˜é‡åŒæ­¥åˆ° Vercelï¼Œç¡®ä¿ Vercel ä¸Šçš„åº”ç”¨èƒ½å¤Ÿæ­£ç¡®è¯»å–è¿™äº›æ•æ„Ÿé…ç½®ã€‚

> âš ï¸ **æ³¨æ„**ï¼šæ„å»ºæ—¶é…ç½®çš„ç¯å¢ƒå˜é‡åªåœ¨ GitHub Actions æ„å»ºè¿‡ç¨‹ä¸­ç”Ÿæ•ˆï¼Œä¸ä¼šè‡ªåŠ¨åŒæ­¥åˆ° Vercel ç”Ÿäº§ç¯å¢ƒã€‚å› æ­¤éœ€è¦ä½¿ç”¨ `vercel link` é“¾æ¥é¡¹ç›®åï¼Œå†ç”¨ `vercel env add` å‘½ä»¤æ˜¾å¼åŒæ­¥ã€‚

#### Vercel éƒ¨ç½²

```yaml
- name: éƒ¨ç½²åˆ° Vercel
  run: |
    npx vercel@latest --prod --token=${{ secrets.VERCEL_TOKEN }}
```

ä½¿ç”¨ `npx vercel@latest` ç›´æ¥è°ƒç”¨ Vercel CLI è¿›è¡Œéƒ¨ç½²ï¼Œæ— éœ€å…¨å±€å®‰è£…ã€‚ä½¿ç”¨ `--prod` å‚æ•°éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

---

## äº”ã€å®Œæ•´å·¥ä½œæµæ‰§è¡Œè§£æ

å½“ä½ å°†ä»£ç æ¨é€åˆ° master åˆ†æ”¯åï¼Œæ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹å°±ä¼šå¯åŠ¨ã€‚ä¸‹é¢çš„æµç¨‹å›¾å±•ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          GitHub Actions å·¥ä½œæµæ‰§è¡Œæµç¨‹                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µä¸€ï¼šè§¦å‘ä¸å‡†å¤‡                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   Git Push â”€â”€â”€â”€â”€â”€â–º GitHub æ£€æµ‹åˆ° push äº‹ä»¶ â”€â”€â”€â”€â”€â”€â–º è§¦å‘ Workflow              â”‚
â”‚                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  å·¥ä½œæµçŠ¶æ€ï¼šqueued                                                  â”‚     â”‚
â”‚   â”‚  è¿è¡Œæ—¶é—´ï¼šç­‰å¾…ä¸­...                                                  â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µäºŒï¼šä»£ç æ£€å‡º                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   Step 1: Checkout code                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  uses: actions/checkout@v4                                          â”‚     â”‚
â”‚   â”‚  â± è€—æ—¶ï¼š~2ç§’                                                        â”‚     â”‚
â”‚   â”‚  ğŸ“¥ ä¸‹è½½æºç åˆ° runner                                                â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µä¸‰ï¼šç¯å¢ƒæ­å»º                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   Step 2: Setup pnpm          Step 3: Setup Node.js                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚   â”‚ uses: pnpm/         â”‚      â”‚ node-version: 20   â”‚                         â”‚
â”‚   â”‚   action-setup@v4   â”‚ â”€â”€â”€â–º â”‚ cache: 'pnpm'      â”‚                         â”‚
â”‚   â”‚ â± ~5ç§’             â”‚      â”‚ â± ~10ç§’            â”‚                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µå››ï¼šä¾èµ–å®‰è£…ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   Step 4: Get pnpm store path                                                  â”‚
â”‚   Step 5: pnpm cache           Step 6: Install dependencies                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚   â”‚ è®¾ç½®ç¼“å­˜è·¯å¾„        â”‚      â”‚ pnpm install       â”‚                         â”‚
â”‚   â”‚ â± ~1ç§’             â”‚ â”€â”€â”€â–º â”‚ --frozen-lockfile  â”‚                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â± ~15ç§’ (ç¼“å­˜å‘½ä¸­)  â”‚                         â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                                 â”‚
â”‚   ğŸ“¦ ç¼“å­˜å‘½ä¸­ï¼špnpm store (98% å‘½ä¸­ç‡)                                        â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µäº”ï¼šé¡¹ç›®æ„å»º                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   Step 7: Next.js build cache                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  path: .next/cache                                                   â”‚     â”‚
â”‚   â”‚  key: ubuntu-nextjs-[hash]                                          â”‚     â”‚
â”‚   â”‚  â± ~3ç§’ (ç¼“å­˜æ¢å¤)                                                  â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                      â”‚                                         â”‚
â”‚                                      â–¼                                         â”‚
â”‚   Step 8: Build Next.js project                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  run: pnpm run build                                                â”‚     â”‚
â”‚   â”‚  â± ~45ç§’ (ç¼“å­˜å‘½ä¸­)                                                 â”‚     â”‚
â”‚   â”‚                                                                          â”‚
â”‚   â”‚  â–² Next.js 16.1.6 (Turbopack)                                        â”‚
â”‚   â”‚  âœ“ Compiled successfully in 2.5s                                      â”‚
â”‚   â”‚  âœ“ Generating static pages (8/8)                                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µå…­ï¼šéƒ¨ç½²åˆ° Vercel                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   Step 8: åŒæ­¥ç¯å¢ƒå˜é‡åˆ° Vercel                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  npx vercel env add ZHIPU_API_KEY production                        â”‚     â”‚
â”‚   â”‚  npx vercel env add MXNZP_APP_ID production                        â”‚     â”‚
â”‚   â”‚  npx vercel env add MXNZP_APP_SECRET production                   â”‚     â”‚
â”‚   â”‚  â± ~10ç§’                                                             â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                      â”‚                                         â”‚
â”‚                                      â–¼                                         â”‚
â”‚   Step 9: éƒ¨ç½²åˆ° Vercel                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  npx vercel@latest --prod                                           â”‚     â”‚
â”‚   â”‚  â± ~20ç§’                                                             â”‚     â”‚
â”‚   â”‚                                                                          â”‚
â”‚   â”‚  âœ“ Building...                                                       â”‚     â”‚
â”‚   â”‚  âœ“ Deploying to Vercel...                                            â”‚     â”‚
â”‚   â”‚  âœ“ Deployment completed!                                            â”‚     â”‚
â”‚   â”‚                                                                          â”‚
â”‚   â”‚  ğŸ”— https://your-project.vercel.app                                  â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éƒ¨ç½²å®Œæˆï¼                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   âœ… å·¥ä½œæµçŠ¶æ€ï¼šsuccess                                                        â”‚
â”‚   â± æ€»è€—æ—¶ï¼šçº¦ 1åˆ†30ç§’ (ç¼“å­˜å‘½ä¸­)                                              â”‚
â”‚   ğŸ”— è®¿é—®åœ°å€ï¼šhttps://your-project.vercel.app                                â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€CI æ£€æŸ¥ä¸éƒ¨ç½²åˆ†ç¦»ï¼ˆè¿›é˜¶ï¼‰

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›ä»£ç åˆå¹¶åˆ° master ä¹‹å‰å°±è¿›è¡Œè´¨é‡æ£€æŸ¥ã€‚æœ€ä½³å®è·µæ˜¯åˆ›å»ºä¸¤ä¸ªç‹¬ç«‹çš„å·¥ä½œæµï¼šCI å·¥ä½œæµè´Ÿè´£ä»£ç æ£€æŸ¥ï¼ŒDeploy å·¥ä½œæµè´Ÿè´£éƒ¨ç½²ã€‚

### 6.1 CI å·¥ä½œæµé…ç½®

åˆ›å»º `.github/workflows/ci.yml`ï¼š

```yaml
name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    strategy:
      matrix:
        node-version: [18, 20, 22]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'pnpm'

      - name: Get pnpm store path
        shell: bash
        run: |
          echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV

      - name: pnpm cache
        uses: actions/cache@v4
        with:
          path: ${{ env.STORE_PATH }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-store-

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Next.js build cache
        uses: actions/cache@v4
        with:
          path: .next/cache
          key: ${{ runner.os }}-nextjs-${{ matrix.node-version }}-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-nextjs-${{ matrix.node-version }}-

      - name: Run Biome lint
        run: pnpm run lint

      - name: Run Biome format check
        run: pnpm run format -- --check

      - name: Build Next.js project
        run: pnpm run build
```

### 6.2 ä¸¤ä¸ªå·¥ä½œæµçš„åä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          åŒå·¥ä½œæµåä½œæµç¨‹                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   PR æäº¤/æ›´æ–°      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      CI Workflow    â”‚        â”‚  GitHub è‡ªåŠ¨åˆå¹¶    â”‚
        â”‚  (æ‰€æœ‰åˆ†æ”¯è§¦å‘)     â”‚        â”‚  (é€šè¿‡å®¡æŸ¥å)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                                â”‚
                   â–¼                                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  âœ… Lint æ£€æŸ¥       â”‚        â”‚                     â”‚
        â”‚  âœ… Format éªŒè¯     â”‚        â”‚                     â”‚
        â”‚  âœ… ç±»å‹æ£€æŸ¥        â”‚        â”‚                     â”‚
        â”‚  âœ… æ„å»ºæµ‹è¯•        â”‚        â”‚                     â”‚
        â”‚  âœ… å¤šç‰ˆæœ¬æµ‹è¯•      â”‚        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                     â”‚
                   â”‚                    â”‚                     â”‚
                   â–¼                    â–¼                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                     â”‚
        â”‚   PR æ£€æŸ¥é€šè¿‡ âœ…    â”‚        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                     â”‚
                   â”‚                    â”‚                     â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                              â–¼                              â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
                   â”‚  åˆå¹¶åˆ° master      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   Deploy Workflow   â”‚
                   â”‚  (ä»… master è§¦å‘)   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  âœ… éƒ¨ç½²åˆ° Vercel   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 7.1 æ„å»ºå¤±è´¥

**é—®é¢˜**ï¼šå·¥ä½œæµåœ¨ Build Next.js project æ­¥éª¤å¤±è´¥

**æ’æŸ¥æ­¥éª¤**ï¼š

1. åœ¨ GitHub ä»“åº“çš„ Actions é¡µé¢æŸ¥çœ‹å¤±è´¥ä»»åŠ¡çš„æ—¥å¿—
2. æ‰¾åˆ°å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œå®šä½é—®é¢˜åŸå› 

**å¸¸è§åŸå› ä¸è§£å†³æ–¹æ¡ˆ**ï¼š

| é”™è¯¯ç±»å‹ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| ä¾èµ–å®‰è£…å¤±è´¥ | ç¯å¢ƒå˜é‡æœªé…ç½® | åœ¨ GitHub Secrets ä¸­æ·»åŠ ç¼ºå¤±çš„å˜é‡ |
| TypeScript é”™è¯¯ | ä»£ç å­˜åœ¨ç±»å‹é—®é¢˜ | ä¿®å¤ç±»å‹é”™è¯¯åå†æ¨é€ |
| å†…å­˜ä¸è¶³ | æ„å»ºå ç”¨å†…å­˜è¿‡å¤§ | å°è¯•é™ä½ Node.js ç‰ˆæœ¬ |

### 7.2 éƒ¨ç½²å¤±è´¥

**é—®é¢˜**ï¼šDeploy to Vercel æ­¥éª¤å¤±è´¥

**å¸¸è§åŸå› **ï¼š

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| Token is invalid | VERCEL_TOKEN é…ç½®é”™è¯¯ | æ£€æŸ¥å¹¶é‡æ–°é…ç½®ä»¤ç‰Œï¼Œç¡®ä¿æ˜¯åœ¨ https://vercel.com/account/settings/tokens åˆ›å»ºçš„ Tokenï¼ˆvcp_ å¼€å¤´ï¼‰ |
| Your codebase isn't linked to a project | æœªé“¾æ¥ Vercel é¡¹ç›® | æ·»åŠ  `vercel link` æ­¥éª¤å…ˆé“¾æ¥é¡¹ç›® |
| Project not found | é¡¹ç›® ID é…ç½®é”™è¯¯ | ç¡®è®¤ VERCEL_PROJECT_ID æ­£ç¡® |
| Permission denied | ä»¤ç‰Œæƒé™ä¸è¶³ | ç¡®ä¿ä»¤ç‰Œå…·æœ‰é¡¹ç›®è®¿é—®æƒé™ |

### 7.3 ç¯å¢ƒå˜é‡åœ¨ Vercel ä¸Šä¸ç”Ÿæ•ˆ

**é—®é¢˜**ï¼šæœ¬åœ°å¼€å‘æ­£å¸¸ï¼Œä½†éƒ¨ç½²åˆ° Vercel åè·å–æ•°æ®å¤±è´¥

**åŸå› **ï¼šGitHub Actions æ„å»ºæ—¶é…ç½®çš„ç¯å¢ƒå˜é‡ï¼ˆå¦‚ `ZHIPU_API_KEY`ã€`MXNZP_APP_ID` ç­‰ï¼‰åªåœ¨æ„å»ºè¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œä¸ä¼šè‡ªåŠ¨åŒæ­¥åˆ° Vercelã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

æœ¬æ•™ç¨‹é‡‡ç”¨çš„æ–¹æ³•æ˜¯åœ¨ workflow ä¸­å…ˆé“¾æ¥é¡¹ç›®ï¼Œå†ä½¿ç”¨ `vercel env add` å‘½ä»¤è‡ªåŠ¨åŒæ­¥ï¼š

```yaml
- name: é“¾æ¥ Vercel é¡¹ç›®
  run: |
    npx vercel@latest link --token=${{ secrets.VERCEL_TOKEN }} --yes

- name: æ·»åŠ ç¯å¢ƒå˜é‡åˆ° Vercel
  run: |
    echo "${{ secrets.ZHIPU_API_KEY }}" | npx vercel@latest env add ZHIPU_API_KEY production --token=${{ secrets.VERCEL_TOKEN }}
    echo "${{ secrets.MXNZP_APP_ID }}" | npx vercel@latest env add MXNZP_APP_ID production --token=${{ secrets.VERCEL_TOKEN }}
    echo "${{ secrets.MXNZP_APP_SECRET }}" | npx vercel@latest env add MXNZP_APP_SECRET production --token=${{ secrets.VERCEL_TOKEN }}
```

æˆ–è€…æ‰‹åŠ¨åœ¨ Vercel Dashboard â†’ é¡¹ç›® Settings â†’ Environment Variables ä¸­æ·»åŠ ã€‚

### 7.3 ç¼“å­˜æœªç”Ÿæ•ˆ

**é—®é¢˜**ï¼šæ¯æ¬¡æ„å»ºéƒ½éœ€è¦é‡æ–°ä¸‹è½½ä¾èµ–

**å¯èƒ½åŸå› **ï¼š

1. ç¼“å­˜ key åŒ…å«çš„ç‰ˆæœ¬ä¿¡æ¯ä¸æ­£ç¡®
2. ç¼“å­˜å­˜å‚¨è¾¾åˆ° GitHub é™åˆ¶
3. ä½¿ç”¨äº†ä¸åŒçš„æ“ä½œç³»ç»Ÿå¯¼è‡´ç¼“å­˜ä¸å…¼å®¹

---

## å…«ã€æ€»ç»“

é€šè¿‡æœ¬æ–‡çš„è¯¦ç»†ä»‹ç»ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†ä½¿ç”¨ GitHub Actions é€šè¿‡ã€ŒDeploy from a branchã€æ–¹å¼å°† Next.js é¡¹ç›®éƒ¨ç½²åˆ° Vercel çš„å®Œæ•´æ–¹æ³•ã€‚

### æ ¸å¿ƒè¦ç‚¹å›é¡¾

1. **Vercel å‡­è¯é…ç½®**ï¼šåˆ›å»º Legacy Tokenã€è·å– User ID å’Œ Project IDï¼Œé…ç½® GitHub Secrets
2. **å·¥ä½œæµé…ç½®**ï¼šä½¿ç”¨ pnpmã€åŒå±‚ç¼“å­˜ã€Next.js æ„å»ºç¼“å­˜ä¼˜åŒ–æ„å»ºé€Ÿåº¦
3. **ç¯å¢ƒå˜é‡ä¼ é€’**ï¼šé€šè¿‡ `vercel env add` å‘½ä»¤è‡ªåŠ¨åŒæ­¥ç¯å¢ƒå˜é‡åˆ° Vercel
4. **CI åˆ†ç¦»**ï¼šæ¨èåˆ›å»ºç‹¬ç«‹çš„ CI å·¥ä½œæµè¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥

### æ€§èƒ½æ•°æ®

ä½¿ç”¨æœ¬æ–‡çš„é…ç½®åï¼Œå…¸å‹çš„æ„å»ºæ—¶é—´å¦‚ä¸‹ï¼š

| æ„å»ºç±»å‹ | é¦–æ¬¡æ„å»º | ç¼“å­˜å‘½ä¸­ |
|---------|---------|---------|
| å®Œæ•´æ„å»º | ~3åˆ†é’Ÿ | ~1.5åˆ†é’Ÿ |
| å¢é‡æ„å»º | ~3åˆ†é’Ÿ | ~30ç§’ |

è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸ä»…æå‡äº†å¼€å‘æ•ˆç‡ï¼Œæ›´é‡è¦çš„æ˜¯ç¡®ä¿äº†æ¯ä¸€æ¬¡éƒ¨ç½²çš„å¯é‡å¤æ€§å’Œå¯é æ€§ã€‚èµ¶å¿«å°è¯•é…ç½®å±äºä½ è‡ªå·±çš„ CI/CD æµæ°´çº¿å§ï¼

---

*æœ¬æ–‡åŸºäº Punchliner é¡¹ç›®çš„å®é™…é…ç½®ç¼–å†™ï¼Œé€‚ç”¨äº Next.js 16 + pnpm + GitHub Actions + Vercel çš„æŠ€æœ¯æ ˆã€‚*
