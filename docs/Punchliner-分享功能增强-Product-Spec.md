# Punchliner 分享功能增强 - Product Spec

## 1. 产品概述

### 1.1 产品定位

 Punchliner（包袱铺）段子分享应用的功能增强模块，通过AI技术为用户提供炫酷的分享图片生成、朋友圈预览和动画视频制作能力，让用户能够将有趣的内容分享给朋友，同时推广产品。

### 1.2 目标用户

- **主要用户**：喜欢看段子、分享段子的年轻用户（18-35岁）
- **使用场景**：
  1. 看到有趣的段子，生成配图分享给朋友
  2. 分享到朋友圈"装逼"，展示自己发现的有趣内容
  3. 制作动画视频，分享更有创意的内容

### 1.3 核心价值

- 降低分享门槛，用户只需一键即可生成炫酷的分享素材
- AI自动配图，让普通内容也能变得"高大上"
- 动画视频功能增加分享的多样性和趣味性

---

## 2. 功能需求

### 2.1 核心功能列表

#### 功能1：分享图片生成

- **描述**：生成一张16:9比例的分享图片，包含AI生成的配图、内容文字和二维码
- **输入**：段子内容、详情页URL
- **输出**：一张可直接分享的图片（PNG/JPG）
- **AI能力**：图像生成（智谱AI）

**详细规格**：
- 整体比例：16:9（宽度优先适配朋友圈）
- 布局结构：
  ```
  ┌─────────────────────────────────────────┐
  │                                         │
  │           AI 生成的配图区域               │
  │           (约占总高度 55%)               │
  │                                         │
  ├────────────────────┬────────────────────┤
  │                    │                    │
  │    内容文字区域     │     二维码区域      │
  │    (约占宽度60%)   │    (约占宽度40%)   │
  │                    │                    │
  │   截断2-3行显示    │   右下角对齐        │
  │                    │                    │
  └────────────────────┴────────────────────┘
  ```
- 内容截断：最多显示3行，超出部分用"..."省略
- 二维码：使用当前详情页URL（Base64加密后的参数）生成的二维码
- 设计风格：炫酷、时尚、大方、年轻化

#### 功能2：朋友圈预览

- **描述**：在生成分享图片前，展示该图片分享到朋友圈后的效果预览
- **输入**：待分享的图片
- **输出**：模拟朋友圈界面的预览效果
- **AI能力**：无

**详细规格**：
- 预览界面模拟微信朋友圈的展示效果
- 包含：用户头像、昵称、图片、点赞/评论区域（模拟）
- 底部显示"保存图片"和"分享"按钮

#### 功能3：AI动画视频生成

- **描述**：根据段子内容生成一段卡通风格的动画视频
- **输入**：段子内容
- **输出**：720P MP4格式的动画视频
- **AI能力**：视频生成（免费AI中选择最佳方案）

**详细规格**：
- 视频风格：卡通/动画
- 分辨率：720P
- 格式：MP4
- 时长：根据内容自适应（不限于3-10秒，可以更长）
- 核心思路：将AI生成的静态配图转化为动态视频，或者根据内容重新生成动画

### 2.2 URL加密方案

- **加密方式**：Base64编码
- **参数名**：data
- **原始格式**：`/joke/[id]?content=xxx&time=xxx`
- **加密后格式**：`/joke/[id]?data=Base64编码内容`
- **解密**：详情页加载时自动解密Base64获取content和time参数

### 2.3 分享流程优化

- 列表页点击卡片跳转到详情页时，使用加密后的URL参数
- 详情页增加"分享"按钮，点击后弹出分享选项菜单
- 分享选项包含：生成分享图片、生成动画视频、复制链接

---

## 3. 用户流程

### 3.1 分享图片生成流程

1. **用户浏览段子列表**
   - 用户在首页浏览段子列表
   - 点击任意段子卡片进入详情页

2. **进入详情页（URL已加密）**
   - 页面从URL中解密获取content和time参数
   - 展示段子详情内容

3. **点击分享按钮**
   - 用户点击详情页的"分享"按钮
   - 弹出分享选项菜单（分享图片、动画视频、复制链接）

4. **选择生成分享图片**
   - 用户选择"生成分享图片"
   - 系统调用智谱AI根据内容生成配图
   - 系统合成配图+文字+二维码生成最终分享图片

5. **预览分享效果**
   - 展示"朋友圈预览"界面
   - 用户确认效果后，可选择保存或直接分享

6. **保存/分享**
   - 用户保存图片到本地，或调用系统分享功能

### 3.2 动画视频生成流程

1. 同上流程1-3
2. **选择生成动画视频**
   - 用户选择"生成动画视频"
   - 系统调用AI视频生成服务
   - 生成720P卡通风格MP4视频

3. **预览与分享**
   - 视频生成完成后展示预览
   - 用户可保存或分享视频

### 3.3 异常流程

**异常情况1**：AI生成失败
- 触发条件：智谱AI接口调用失败或返回错误
- 处理方式：显示错误提示，提供"重试"按钮

**异常情况2**：二维码生成失败
- 触发条件：URL过长或二维码库处理失败
- 处理方式：跳过二维码区域，仅展示配图+文字

**异常情况3**：Base64解密失败
- 触发条件：URL参数被篡改或格式错误
- 处理方式：跳转回首页或显示"内容无效"

---

## 4. UI/UX 设计

### 4.1 整体布局

**详情页布局**：
```
┌─────────────────────────────────────┐
│            Header (返回按钮+标题)     │
├─────────────────────────────────────┤
│                                     │
│           段子内容区域               │
│                                     │
├─────────────────────────────────────┤
│           底部操作栏                 │
│  [收藏] [分享] [AI配图] [动画视频]   │
└─────────────────────────────────────┘
```

### 4.2 页面详细设计

#### 页面1：段子详情页

**布局**：
- Header高度：56px，包含返回按钮和标题
- 内容区域：自适应剩余高度
- 底部操作栏：固定高度60px

**输入区域**：
- 无需用户输入，内容从URL参数获取

**输出区域**：
- 段子内容展示
- 底部操作按钮组

**交互细节**：
- 点击"分享"按钮弹出操作菜单
- 点击"AI配图"直接生成分享图片并弹出预览
- 点击"动画视频"触发视频生成并显示进度

#### 页面2：分享预览弹窗

**布局**：
- 全屏弹窗，背景半透明黑色
- 分享图片居中显示
- 底部操作按钮

**布局结构**：
```
┌─────────────────────────────────────┐
│         朋友圈预览                   │  ← 标题栏
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │      模拟朋友圈样式          │   │
│  │                             │   │
│  │  [头像] 昵称                │   │
│  │  ┌─────────────────────┐    │   │
│  │  │                     │    │   │
│  │  │    分享图片预览      │    │   │
│  │  │                     │    │   │
│  │  └─────────────────────┘    │   │
│  │  👍  💬                    │   │
│  └─────────────────────────────┘   │
├─────────────────────────────────────┤
│   [保存图片]    [直接分享]          │
└─────────────────────────────────────┘
```

#### 页面3：分享图片（最终输出）

**布局**（16:9比例）：
```
┌─────────────────────────────────────────┐
│                                         │
│                                         │
│           AI 生成的配图                  │
│           (55% 高度)                      │
│                                         │
│                                         │
├────────────────────┬────────────────────┤
│                    │                    │
│   段子内容文字      │                    │
│   (2-3行截断)      │      二维码        │
│                    │    (右下角)         │
│                    │                    │
└────────────────────┴────────────────────┘
```

**设计风格**：
- 参考MuseLink分享卡设计
- 炫酷、时尚、大方
- 配色：渐变+撞色，突出年轻化
- 字体：粗体标题+清晰正文
- 圆角、阴影等现代UI元素

### 4.3 控件规范

**分享按钮**：
- 位置：详情页底部操作栏
- 样式：主按钮（品牌色）、次按钮（灰色描边）
- 尺寸：高度44px，宽度自适应

**分享图片**：
- 宽度：100%容器宽度
- 高度：按16:9比例自适应
- 圆角：12px
- 阴影：轻微投影

**二维码**：
- 尺寸：80x80px ~ 100x100px
- 位置：右下角，与文字底部对齐
- 周围留白：8px

---

## 5. Google AI Studio 能力配置

### 5.1 使用的 AI 能力列表

| AI 能力 | 用途 | 使用场景 |
|---------|------|----------|
| 图像生成 | 根据段子内容生成配图 | 用户点击"AI配图"或生成分享图片时 |
| 视频生成 | 生成卡通风格动画视频 | 用户点击"动画视频"时 |

### 5.2 能力配置说明

**能力1：图像生成（智谱AI）**
- 配置参数：
  - 模型：智谱AI图像生成模型（如GLM-4V）
  - 分辨率：建议1024x576（16:9）
  - 风格：卡通/插画风格
- 调用时机：用户点击生成分享图片时
- 输入格式：段子内容文本
- 输出格式：图片URL或Base64

**能力2：视频生成（免费AI方案）**
- 推荐方案：**Pika Labs** 或 **RunwayML**
- 配置参数：
  - 分辨率：720P
  - 风格：卡通/动画
  - 时长：根据内容自适应
  - 格式：MP4
- 调用时机：用户点击生成动画视频时
- 输入格式：段子内容文本 + 可选的参考图片
- 输出格式：视频URL或文件

**备选方案**：
- Luma Dream Machine
- Stability AI Video
- 腾讯智影（国内访问更稳定）

---

## 6. 技术需求

### 6.1 技术要求

- **前端框架**：Next.js 16 + React 19
- **UI组件库**：Ant Design 6
- **二维码生成**：qrcode 库
- **图片合成**：Canvas 或 html2canvas
- **URL加密**：Base64编码/解码
- **AI接口**：智谱AI API（图像生成）、第三方视频AI（动画视频）

### 6.2 性能要求

- 图片生成：控制在10秒内
- 视频生成：控制在60秒内（内容越长可能越久）
- 页面加载：首屏控制在2秒内

### 6.3 数据要求

- 段子内容：存储在本地或从API获取
- 生成的图片/视频：临时存储或直接返回给用户
- 用户无需登录即可使用分享功能

---

## 7. 优先级规划

### 7.1 第一期（MVP）

- [x] 分享图片生成（智谱AI配图 + 文字 + 二维码）
- [x] 朋友圈预览功能
- [x] URL加密（Base64）
- [x] 二维码生成

### 7.2 第二期

- [ ] AI动画视频生成
- [ ] 视频预览与下载

### 7.3 未来规划

- [ ] 多种分享模板选择
- [ ] AI配图风格选择（卡通、真实、油画等）
- [ ] 视频模板选择
- [ ] 分享数据统计

---

## 8. 参考产品

### 8.1 参考产品列表

- **MuseLink分享卡**：参考其分享图片的布局设计
- **微信朋友圈**：参考预览界面的模拟效果

### 8.2 差异化说明

- 本产品专注于段子内容，AI自动理解内容生成配图
- 提供朋友圈预览功能，让用户分享前先确认效果
- 支持动画视频生成，增加分享的多样性

---

## 9. 待补充事项

- [ ] 智谱AI API Key配置
- [ ] 视频生成AI的API接入（选择Pika Labs或其他）
- [ ] 分享图片的具体设计定稿（使用ui-ux-pro-max设计）
- [ ] 分享数据统计功能（可选）

---

## 附录：使用说明

在 Google AI Studio Builder 中使用此 Product Spec 时：

1. **勾选AI能力**：
   - 图像生成（Image Generation）- 用于生成配图
   - 视频生成（Video Generation）- 用于生成动画视频

2. **配置参数**：
   - 图像生成：设置分辨率为16:9（1024x576），风格为卡通
   - 视频生成：设置分辨率为720P，风格为卡通

3. **实现功能**：
   - 按照"功能需求"和"用户流程"部分实现功能
   - 使用Base64进行URL加密/解密

4. **设计界面**：
   - 按照"UI/UX设计"部分实现界面布局和交互
   - 分享图片设计可调用ui-ux-pro-max技能

5. **注意**：
   - 本Spec中视频生成使用免费AI方案，需根据实际接入的AI服务调整配置
   - 智谱AI不支持视频生成，需要使用其他AI服务
